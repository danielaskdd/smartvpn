=======================
=== 小米路由白名单设置 ===
=======================

小米路由科学上网的白名单为路由器上的 /etc/smartvpn/proxy.txt 文件。文件上的域名将使用谷歌DNS（8.8.8.8 ）来解析。通过这个DNS解析出来的ip流量将引导到VPN通道。


需要把无论如何都要走VPN的ip入到白名单中。从香港出来的流量DNS查询1.1.1.1，无法依赖小米路由智能引导，因此需要加到白名单中。其它常用的公共DNS也应该加到白名单中。

# Google ip
172.217.0.0/16 
216.58.0.0/16

# 苹果ip
17.91.0.0/16
17.224.0.0/11
23.7.208.0/20
23.7.224.0/20
23.198.112.0/20
23.198.128.0/20
184.28.34.0/23

# 主流公共DNS
1.0.0.0/15
8.8.0.0/16
9.9.0.0/16
149.112.0.0/16
208.67.0.0/16

============================
=== 美国Linode服务器SE配置 ===
============================

SE NAT必须把DNS放到路由推送表中，而不能作为DNS推送。因为小米路由会把VPN推送过来的DNS加入到dnsmasq的父DNS清单中，从而导致进行DNS解析错误地选择了海外的DNS。

SE NAT推送路由表：把需要把流量引导到香港服务器的ip加入其中
1.0.0.0/15/192.168.30.2 35.231.145.0/24/192.168.30.2 172.217.160.0/22/192.168.30.2 172.217.24.0/21/192.168.30.2 216.58.192.0/20/192.168.30.2 216.58.208.0/20/192.168.30.2 35.190.31.0/24/192.168.30.2 35.190.55.0/24/192.168.30.2 104.244.40.0/21/192.168.30.2 17.91.8.0/21/192.168.30.2 17.91.64.0/19/192.168.30.2 17.248.152.0/21/192.168.30.2 17.248.160.0/24/192.168.30.2 17.253.84.0/22/192.168.30.2 23.7.208.0/20/192.168.30.2 23.7.224.0/20/192.168.30.2 23.198.112.0/20/192.168.30.2 23.198.128.0/20/192.168.30.2 184.28.34.0/23/192.168.30.2

以上推送路由表的解析如下：

== 香港出口DNS路由
1.0.0.0/15/192.168.30.2          # 1.1.1.1 / 1.0.0.1

== GitLab香港路由
35.231.145.0/24/192.168.30.2

== Google香港路由
172.217.160.0/22/192.168.30.2    172.217.160~163.xxx
172.217.24.0/21/192.168.30.2     172.217.24~31.xxx
216.58.192.0/20/192.168.30.2     216.58.192~207.xxx
216.58.208.0/20/192.168.30.2     216.58.208~223.xxx

== 文学城香港路由
35.190.31.0/24/192.168.30.2
35.190.55.0/24/192.168.30.2

== Twitter香港路由
104.244.40.0/21/192.168.30.2     104.244.40~47.xxx

== Apple香港路由
17.91.8.0/21/192.168.30.2        17.91.8~15.xxx
17.91.64.0/19/192.168.30.2       17.91.64~95.xxx
17.248.152.0/21/192.168.30.2     17.248.152~159.0
17.248.160.0/24/192.168.30.2
17.253.84.0/22/192.168.30.2      17.253.84~87.xxx
23.7.208.0/20/192.168.30.2       23.7.208~223.xxx
23.7.224.0/20/192.168.30.2       23.7.224~239.xxx
23.198.112.0/20/192.168.30.2     23.198.112~127.xxx
23.198.128.0/20/192.168.30.2     23.198.128~143.xxx
184.28.34.0/23/192.168.30.2      184.28.34~35.xxx


== 注意：以上规则错误地把以下非香港ip转到香港为出口，为避免规则太多太碎，暂时不予以纠正
216.58.195.238  是美国ip不是香港


==============================
======== 客户端DNS设置 =========
==============================

公司网络访问海外服务器的默认出口为美国。由于通过香港访问谷歌服务器的速度远快于通过美国访问，可以通过以下设置让本机改由香港访问谷歌服务器。

设置成功后命令 ping www.google.com 报告的访问时间应该小于20ms（原来应该为160ms以上）

======================
=== Mac OS 设置方法 ===
======================
苹果电脑的/etc/resolver目录（需要手工创建）下，按以下4个文件即可提高谷歌相关服务器的访问速度：
   google.com
   youtube.com
   youtu.be
   googlevideo.com
   developer.apple.com
每个文件到内容都一样，只需填写两行：
nameserver 1.1.1.1
nameserver 1.0.0.1


=====================
=== Win10 设置方法 ===
=====================
以管理员身份启动Powershell，并执行一下命令设定DNS规则：
Add-DnsClientNrptRule -Namespace "google.com" -NameServers "1.1.1.1"
Add-DnsClientNrptRule -Namespace "youtube.com" -NameServers "1.1.1.1"
Add-DnsClientNrptRule -Namespace "youtu.be" -NameServers "1.1.1.1"
Add-DnsClientNrptRule -Namespace "googlevideo.com" -NameServers "1.1.1.1"

=== 附DNS规则管理命令
Get-DnsClientNrptRule                                                       #显示规则
Remove-DnsClientNrptRule -Name "{288FD7D4-F146-45BD-8D2E-2C7B15280577}"     #删除规则

===============================================================================
注：如果需要让其它域名也通过香港通道加速，做法如下：
1. 为需要加速的域名在Mac OS本地设置域名解析配置，DNS指向1.1.1.1
2. 为需要加速的域名可能解析出来的ip放到SE服务器的路有推送表，把流量引导到香港
3. 找出需要加速的域名在香港可以获得的ip段，并把之添加到Linode上的SE路由推送表（引流到香港）
4. 为了保险起见（防止域名ip变化后无法访问），把需要加速的域名也添加到白名单中
===============================================================================


公司服务器ip
hk  119.28.12.54
ca  170.106.66.32
us  23.239.5.137
gz  111.230.150.194
appgz 203.195.229.221
wwwgz 193.112.160.51